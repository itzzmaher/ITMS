@model ITMS.Models.tblRating
@using System.IO;
<link href="~/lib/summernote-0.8.18-dist/summernote-lite.css" rel="stylesheet" />
<script src="~/lib/summernote-0.8.18-dist/summernote-lite.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>




<style>
    .top-buffer {
        margin-top: 35px;
    }

    .embed-responsive-item {
        background-color: black;
    }

    .divider {
        border-top: 8px solid #bbb;
        border-radius: 5px;
        color: orange;
    }

    .buttons a:nth-child(1) {
        border: 1px solid #e96b56 !important;
        color: #e96b56;
        height: 40px;
        background-color: #fff
    }

        .buttons a:nth-child(1):hover {
            border: 1px solid #e96b56 !important;
            color: #fff;
            height: 40px;
            background-color: #e96b56
        }


    input[type="radio"] {
        display: none;
    }

    label {
        color: grey;
    }

    .clasificacion {
        direction: rtl;
        unicode-bidi: bidi-override;
    }

    label:hover,
    label:hover ~ label {
        color: orange;
    }

    input[type="radio"]:checked ~ label {
        color: orange;
    }

</style>
@{var data = (tblPlaces)ViewData["PlaceInfo"]; }
@{var CarData = (tblCar)ViewData["CarInfo"]; }
<div class="container">
    @if (data == null)
    {
        <div class="text-center">
            <img src="~/Images/404_image.png" />
            <h4 style="color:midnightblue;">This page doesn't exist.</h4>
            <h4 style="color:midnightblue;">Click <a href="/Places/ViewPlaces">HERE</a> to go back  </h4>
        </div>
    }
    else
    {

        <h1 class="my-4">
            <small>@data.Name</small>
        </h1>

        <div class="row">

            <div class="col-md-8">
                @{ var ext = System.IO.Path.GetExtension(data.ImgName);}
                @if (ext == ".mp4")
                {
                <div align="center" class="embed-responsive embed-responsive-16by9">
                    <video autoplay loop class="embed-responsive-item" controls>
                        <source src="@Url.Content("~/Images/" + data.ImgName)" type="video/mp4">
                    </video>
                </div>
                    @*<div class="video-frame">
                        <video style="width:250px; height:150px;" controls>
                            <source src="@Url.Content("~/Images/" + data.ImgName)" type="video/mp4" />
                        </video>
                    </div>*@
                }
                else
                {
                <img class="img-fluid" src="@("~/Images/" + data.ImgName)" asp-append-version="true" width="750px" height="500px">
                }
            </div>

            <div class="col-md-4">
                <h2 class="my-3">Place Description</h2>
                <p>Date of Creation : <span style="color:dimgray">@data.CreationDate.ToString("yyyy/MMMM/dd")</span></p>
                <p> <span style="color:dimgray">@data.Category.CategoryName</span></p>
                <div id="map" @*style="width: 450px; height: 350px;"*@ href="@data.location"> </div>
                <p>Google Maps Link : <a id="location" href="@data.location">Here</a></p>
                <hr class="divider" />
                <h5>@ViewData["NumberOfVisists"]</h5>
                @if (User.Identity.IsAuthenticated)
                {
                    @if ((int)ViewData["UserCheckVisit"] == 0)
                    {
                        <a asp-action="Visit" asp-controller="Places" asp-route-id="@data.GuId">Record a Visit</a>}
                    else
                    {
                        <p>You visited @data.Name within the last 24 hours</p>
                    }
                }
                @if (User.IsInRole("Guider"))
                {
                    <a asp-action="AddTour" asp-controller="Guider" asp-route-id="@data.GuId">Add tour</a>
                }

                <div id="Distance"></div>
                <p id="msg"></p>

                @*<div class="row">
            <div class="col-md-6">
                <label class="col-form-label">Fuel type</label>
                <select id="Ftype" class="form-control custom-select">
                    <option value="91">91</option>
                    <option value="95">95</option>
                </select>

            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label class="col-form-label">Fuel Economy</label>
                <select id="Economy" class="form-control custom-select">
                    <option value="17">Excellent 15 and above</option>
                    <option value="13">Average 10-15</option>
                    <option value="8">Poor bellow 10 </option>
                </select>

            </div>
        </div>*@
                @if (CarData == null && User.Identity.IsAuthenticated)
                {
                    @*<small>To calcaulte the distance to reach @data.Name you need to enter your car info</small>
            <a class="btn btn-outline-primary" asp-controller="Account" asp-action="AddCar">Add</a>*@
                    @using (Html.BeginForm("AddACar", "Places", FormMethod.Post, new { }))
                    {
                        <div class="row">
                            <div class="col-md-6">
                                <label class="col-form-label">Car Economy</label>
                                <input type="text" name="Name" class="form-control">
                                <input type="text" name="id" value="@data.GuId" hidden>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="col-form-label">Car Economy</label>
                                <input type="number" name="FuelEco" class="form-control" step="0.1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="col-form-label">Gas Type</label>
                                <select class="form-control custom-select" asp-items="ViewBag.FuelId" name="FuelId"></select>

                            </div>
                        </div>


                        <input class="btn btn-dark btn-search" type='Submit' value='Add' />

                    }

                }
                else
                {
                    <a class="btn btn-primary " id="mapFunction" onclick="initMap()">Calculate Price</a>
                    <div id="msg2"></div>
                }
            </div>

        </div>

        <hr class="divider" />
        <h2 class="my-3">Description</h2>
        <div class="row">
            <p>@Html.Raw(data.Description)</p>
        </div>
        <hr class="divider" />
        <div class="row top-buffer"></div>
        IEnumerable<tblRating> Ratings = ViewData["Ratings"] as IEnumerable<tblRating>;
        if (Ratings.Count() > 0)
        {


            <h4>Average Rating : @ViewData["AverageRating"]</h4>
            <div class="row top-buffer"></div>

            <h4>Number of Ratings : @Ratings.Count()</h4>}

                        if (User.Identity.IsAuthenticated && (int)ViewData["UserRatings"] == 0) 
                        {
                            
        <form asp-action="AddRating" id="form">
        
            <p class="container">
        <input id="radio5" type="radio" value=5 asp-for="Rate">

        <label for="radio5">&#9733;</label>

        <input id="radio4" type="radio" value=4 asp-for="Rate">

        <label for="radio4">&#9733;</label>
      
        <input id="radio3" type="radio"value=3 asp-for="Rate">
        
        <label for="radio3">&#9733;</label>
       
        <input id="radio2" type="radio"value=2 asp-for="Rate">
       
        <label for="radio2">&#9733;</label>
       
        <input id="radio1" type="radio" value=1 asp-for="Rate">
       
        <label for="radio1">&#9733;</label>
        </p>
        <div class="row top-buffer">
            <div class="col-8">
                <textarea id="summernote" asp-for="Details"></textarea><br />
            </div>
        </div>
        <input type="text" value="@data.Id" asp-for="PlacesId" hidden />
        <button type="submit" id="do_it" class="btn btn-outline-info" onclick="return Valdation()">Submit</button>

</form>
        }


        var i = 1;

        foreach (var item in Ratings)
        {
            <div class="row top-buffer">
                <div class="col-md-4">
                    <div class="card-body">
                        <h5 class="card-title">@item.User.Name</h5>
                        <p class="card-text">@item.Rate / 5</p>
                        <p>@Html.Raw(@item.Details)</p>
                    </div>
                </div>
            </div>
            i++;
        }

    }
</div>
<script type="text/javascript">
    $('#summernote').summernote({
        fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24'],
        toolbar: [
            // [groupName, [list of button]]
            ['style', ['bold', 'italic', 'underline', 'clear']],
            ['font', ['strikethrough', 'superscript', 'subscript']],
            ['fontsize', ['fontsize']],
            ['color', ['color']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['table', ['table']],
            ['height', ['height']]
        ]
    });
</script>

@if (CarData != null)
{
    <script>

    // Initialize and add the map
    function initMap() {
        var map;
        // The map, centered on Central Park
        function success(pos) {
            var crd = pos.coords;
            var msg = document.getElementById("map");
            msg.style.width = "450px";
            msg.style.height = "350px";
            const center = { lat: crd.latitude, lng: crd.longitude };
            const options = { zoom: 15, scaleControl: true, center: center };
            map = new google.maps.Map(
                document.getElementById('map'), options);
            const dakota = { lat: crd.latitude, lng: crd.longitude };
            const frick = { lat: @ViewData["lon"], lng: @ViewData["lat"] };
            // The markers for The Dakota and The Frick Collection
            var mk1 = new google.maps.Marker({ position: dakota, map: map });
            var mk2 = new google.maps.Marker({ position: frick, map: map });
                    let directionsService = new google.maps.DirectionsService();
                    let directionsRenderer = new google.maps.DirectionsRenderer();
                    directionsRenderer.setMap(map); // Existing map object displays directions
                                                    // Create route from existing points used for markers
                    const route = {
                origin: dakota,
                destination: frick,
                travelMode: 'DRIVING'
               }

                directionsService.route(route,
                    function (response, status) { // anonymous function to capture directions
                    if (status !== 'OK') {
                        window.alert('Directions request failed due to ' + status);
                        return;
                    } else {
                        directionsRenderer.setDirections(response); // Add route to the map
                        var directionsData = response.routes[0].legs[0]; // Get data about the mapped route
                        if (!directionsData) {
                            window.alert('Directions request failed');
                            return;
                        }
                        else {
                            document.getElementById('Distance').innerHTML = " Driving distance is " + directionsData.distance.text + " (" + directionsData.duration.text + ").";
                            var cost = ((directionsData.distance.value / 1000) / @CarData.FuelEco) * @CarData.Fuel.Price;

                            document.getElementById('msg2').innerHTML = "Cost to drive " + cost.toFixed(2) + " SAR";
                        }
                    }
                });


        }
        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
        }
        navigator.geolocation.getCurrentPosition(success, error);

    }
    </script>
}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8nGzbiKU7I2OYSfkFrrzOalu8wV8DE2o">
</script>